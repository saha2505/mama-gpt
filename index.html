<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>mama-gpt</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      background: #fefefe;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    #chat {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
    }
    .gpt {
      font-weight: bold;
      margin-top: 1rem;
    }
    #say-more {
      padding: 1rem;
      border: none;
      background: #444;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="chat"></div>
  <button id="say-more">–°–∫–∞–∑–∞—Ç–∏ —â–µ</button>

  <script>
    const endpoint = 'https://mama-gpt-api.vercel.app/api/chat';
    const chat = document.getElementById('chat');
    const sayMore = document.getElementById('say-more');

    let messages = [];

    async function sendMessageToGPT(text) {
      messages.push({ role: 'user', content: text });

      const res = await fetch(endpoint, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ messages })
      });

      const data = await res.json();
      const reply = data.choices?.[0]?.message?.content || '–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å üò¢';
      messages.push({ role: 'assistant', content: reply });

      chat.innerHTML += `<div class="gpt">ü§ñ ${reply}</div>`;
      chat.scrollTop = chat.scrollHeight;

      speak(reply);
    }

    function speak(text) {
      const msg = new SpeechSynthesisUtterance();
      msg.text = text;
      msg.lang = 'uk-UA';
      msg.rate = 1;
      speechSynthesis.speak(msg);
    }

    function startListening() {
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = 'uk-UA';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onresult = (e) => {
        const text = e.results[0][0].transcript;
        chat.innerHTML += `<div>üßç‚Äç‚ôÄÔ∏è ${text}</div>`;
        sendMessageToGPT(text);
      };

      recognition.onerror = (e) => {
        chat.innerHTML += `<div style="color:red">‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –≥–æ–ª–æ—Å—É: ${e.error}</div>`;
      };

      recognition.start();
    }

    // –ê–≤—Ç–æ—Å—Ç–∞—Ä—Ç –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞–Ω–Ω—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
    window.onload = () => {
      startListening();
    };

    sayMore.onclick = () => {
      startListening();
    };
  </script>
</body>
</html>
